## TW_GR_E1_ART - 100

### Description

Oh, sweet, they made a spinoff game to Toaster Wars! That last room has a lot of flags in it though. I wonder which is the right one...? Check it out [here](http://shell2017.picoctf.com:50681/).

### Hint

  - I think this game is running on a Node.js server. If it's configured poorly, you may be able to access the server's source. If my memory serves me correctly, Node servers have a special file that lists dependencies and a start command; maybe you can use that file to figure out where the other files are?

### Write up

The dependency file of Node.js is `package.json`.

By looking at http://shell2017.picoctf.com:50681/package.json,

it can be found that there are some files like
- /server/serv.js
- /server/game.js
- /server/config.js

Inside of game.js, we can see the item option 'revealFlag' that shows flag,

```js
case "revealFlag":

  if (entity.items[action.item].effects[i].check == 64) {
    outcome.flag = process.env["PICO_CTF_FLAG"];
  }
```

So what is the 'check' option?

When we see top of the config.js file, we can see 'createFlag' function which sets the check value.

```js
function createFlag(check, location) {
	return {
		name: "Flag",
		description: "Gives you the flag... maybe.",
		location: location,
		use: 0,
		id: check + 100,
		sprite: "flag",
		effects: [
			{
				type: "revealFlag",
				check: check
			},
			{
				type: "destroyItems"
			}
		]
	};
}
```

And at the same file, we can see the code that generates multiple flag items with different check, location.

```js
items: Array.from(new Array(83), (_, idx) => {
  if (idx >= 2) {
    idx++
  }

  if (idx >= 77) {
    idx++;
  }

  var r = Math.floor(idx / 5) + 1;
  var c = (idx % 5) + 1;

  return createFlag(idx, { r: r, c: c });
})
```

So the index is the check value, and when idx=64, r=13 and c=5, which is the position.

At the fourth floor, there are multiple flag items. And the flag that is at (13,5) is the right flag, while others are fakes.

> at_least_the_world_wasnt_destroyed_by_a_meteor_edbfaf165234c029da5be344b92a6819
