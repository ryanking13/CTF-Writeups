## ReadFlag - 100

### Analysis

dump.py 와 쉘 스크립트를 살펴보면, 주어진 주소에 pickle.dumps()를 사용하여 리스트를 문자열로 바꾸어 전송한다는 것을 추측할 수 있다.

주어진 dump.py를 그대로 사용하여 [1,2,3] 을 전송하면 리스트의 합이 10이 되도록 전송하라는 메세지가 나오고, [1,2,3,4] 등 10을 만족시켜서 보내면 그에 맞춰 메세지가 출력되고 종료된다.

한편, 리스트에 숫자 대신 문자열 등 다른 데이터를 첨가해서 보내면 서버에서 파싱하는 과정에서 에러가 발생하는데, 이를 통해 해당 스크립트의 이름이 `test.py`이라는 것을 알 수 있다.

### Attack

파이썬 pickle는, 데이터를 복호화 할 때에 특정한 함수가 실행되도록 할 수 있습니다. 이는 class의 \__reduce__() 메소드를 사용하여 이루어진다.

이를 이용하여

> os.system('/bin/sh')

가 실행되도록 페이로드를 구성하면 'Bad System Call'이라는 response가 돌아오는데, 다른 시스템 콜 명령어에 대해서도 같은 결과가 출력되고, 한편으로

> os.getpid()

등은 에러를 발생시키지 않는다.

따라서, 출제자 측에서 특정한 명령어가 실행되는 것을 지정하여 막아놓았다고 판단된다.

이에, 실행이 가능한 여러 built-in 명령어를 확인해보는 도중 eval()이 블락되지 않았다는 것을 확인하였다.

앞서 Analysis부분에서 서버에서 실행되는 스크립트의 이름이 `test.py` 인 것을 확인하였으므로 다음과 같이 페이로드를 구성하였다.

> eval('open('test.py', 'r').read()')

이를 pickle.dumps()로 변환하여 전송하면 test.py 스크립트의 내용을 볼 수 있고, 스크립트에 변수로서 flag가 적힌 것을 확인할 수 있다.
